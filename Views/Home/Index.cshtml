    

@model FigureShop.ViewModels.HomeIndexViewModel
@{
    ViewData["Title"] = "Trang chủ FigureShop";
}
<script>
    // Automatically add/remove dark-mode class to body based on cookie
    window.addEventListener('DOMContentLoaded', function() {
        if (document.cookie.includes('darkmode=true')) {
            document.body.classList.add('dark-mode');
        } else {
            document.body.classList.remove('dark-mode');
        }
    });
</script>
<!-- Image Slider -->

<!-- Bootstrap Carousel Slider -->
<div id="mainCarousel" class="carousel slide mb-4" data-bs-ride="carousel" style="max-width:1100px; margin-left:auto; margin-right:auto;">
  <div class="carousel-inner" style="border-radius:18px; box-shadow:0 4px 12px rgba(0,0,0,0.12);">
    <div class="carousel-item active">
      <img src="/images/1.png" class="d-block w-100" alt="Image 1" style="height:480px; width:100%; object-fit:contain; border-radius:18px; aspect-ratio:16/5; background:#e9ecef;">
    </div>
    <div class="carousel-item">
      <img src="/images/2.png" class="d-block w-100" alt="Image 2" style="height:480px; width:100%; object-fit:contain; border-radius:18px; aspect-ratio:16/5; background:#e9ecef;">
    </div>
    <div class="carousel-item">
      <img src="/images/3.png" class="d-block w-100" alt="Image 3" style="height:480px; width:100%; object-fit:contain; border-radius:18px; aspect-ratio:16/5; background:#e9ecef;">
    </div>
    <div class="carousel-item">
      <img src="/images/4.png" class="d-block w-100" alt="Image 4" style="height:480px; width:100%; object-fit:contain; border-radius:18px; aspect-ratio:16/5; background:#e9ecef;">
    </div>
  </div>
  <button class="carousel-control-prev" type="button" data-bs-target="#mainCarousel" data-bs-slide="prev">
    <span class="carousel-control-prev-icon" aria-hidden="true"></span>
    <span class="visually-hidden">Previous</span>
  </button>
  <button class="carousel-control-next" type="button" data-bs-target="#mainCarousel" data-bs-slide="next">
    <span class="carousel-control-next-icon" aria-hidden="true"></span>
    <span class="visually-hidden">Next</span>
  </button>
  <div class="carousel-indicators">
    <button type="button" data-bs-target="#mainCarousel" data-bs-slide-to="0" class="active" aria-current="true" aria-label="Slide 1"></button>
    <button type="button" data-bs-target="#mainCarousel" data-bs-slide-to="1" aria-label="Slide 2"></button>
    <button type="button" data-bs-target="#mainCarousel" data-bs-slide-to="2" aria-label="Slide 3"></button>
    <button type="button" data-bs-target="#mainCarousel" data-bs-slide-to="3" aria-label="Slide 4"></button>
  </div>
</div>

<!-- Add more spacing between slider and Flash Sale section -->
<div style="height:300px;"></div>



<!-- Pre-order Section (same style as Sale/All Products, now below Sale) -->
@* Move this section below Sale section for correct order *@

<!-- Flash Sale (custom style) -->

<div style="background: transparent; width: 100vw; position: relative; left: 50%; right: 50%; margin-left: -50vw; margin-right: -50vw; box-shadow:0 4px 12px rgba(0,0,0,0.10);">
  <div style="max-width: 1100px; margin-left: auto; margin-right: auto; border-radius: 18px;">
<section class="py-5 mb-5" style="background: linear-gradient(135deg, #a18cd1 0%, #fbc2eb 100%); border-radius: 18px;">
      <div class="px-3">
        <div class="d-flex align-items-center mb-4">
            <span class="badge bg-gradient text-white me-2 px-3 py-2" style="font-size:1.1rem; border-radius:12px; background: linear-gradient(90deg,#ff512f,#dd2476);">Hot!</span>
            <h2 class="mb-0 me-3 fw-bold" style="font-size:2rem; letter-spacing:1px; color:#ff512f;"><i class="bi bi-lightning-charge-fill"></i> FLASH SALE</h2>
            <div class="flex-grow-1">
                <hr class="border-2" style="border-color:#ff512f;">
            </div>
        </div>
        <div class="row justify-content-center g-4">
            @foreach (var product in Model.Products)
            {
                var flash = product.FlashSale;
                var now = DateTime.Now;
                if (flash != null && flash.StartTime <= now && flash.EndTime >= now)
                {
                    var flashPrice = product.Price * (1 - flash.Discount);
                    <div class="col-12 col-sm-6 col-md-4 col-lg-3 d-flex align-items-stretch">
                        <div class="card h-100 border-0 shadow product-card position-relative" style="border-radius: 18px; overflow: hidden; background: #fff; min-width: 240px; max-width: 270px; margin: 0 auto;">
                            <div class="position-absolute top-0 start-0 m-2">
                                <span class="badge text-white px-3 py-1" style="font-size:1rem; border-radius:10px; background: linear-gradient(90deg,#ff512f,#dd2476);">Giảm @((int)(flash.Discount*100))%</span>
                            </div>
                            <img src="@product.ImagePath" class="card-img-top" alt="@product.Name"
                                 style="height: 200px; object-fit: cover; background: #fbc2eb; border-radius: 16px 16px 0 0;">
                            <div class="card-body d-flex flex-column" style="padding-bottom:0.5rem;">
                                <div class="mb-2 d-flex flex-column align-items-start">
                                    <span class="fw-bold" style="font-size:1.3rem; color:#dd2476;">@flashPrice.ToString("N0") ₫</span>
                                    <span class="text-muted text-decoration-line-through" style="font-size:1rem;">@product.Price.ToString("N0") ₫</span>
                                </div>
                                <div class="mb-1">
                                    <h6 class="card-title fw-bold text-truncate mt-1" style="font-size:1.1rem; color:#ff512f;">@product.Name</h6>
                                </div>
                                <div class="d-flex align-items-center mb-2">
                                    <i class="bi bi-clock-history" style="color:#ff512f; margin-right:4px;"></i>
                                    <span class="flash-sale-timer small fw-bold" style="color:#dd2476;" data-end="@flash.EndTime.ToString("s")"></span>
                                </div>
                                <div class="progress" style="height: 7px; border-radius: 5px; background: #fbc2eb;">
                                    <div class="progress-bar" role="progressbar" style="width: 80%; border-radius: 5px; background: linear-gradient(90deg,#ff512f,#dd2476);"></div>
                                </div>
                                <div class="mt-auto pt-2">
                                    <a href="@Url.Action("Details", "Product", new { id = product.Id })"
                                       class="btn btn-sm rounded-pill px-3" style="background: linear-gradient(90deg,#ff512f,#dd2476); color: #fff; border: none;">Xem chi tiết</a>
                                </div>
                            </div>
                        </div>
                    </div>
                }
            }
        </div>
    </div>
</section>


<!-- All Products -->
<section class="py-5" style="background: transparent;">
    <div class="container">
        <div class="d-flex align-items-center justify-content-between mb-4">
            <div class="d-flex align-items-center">
                <h2 class="mb-0 me-3 fw-bold" style="color:#ff512f; letter-spacing:1px;">All Products</h2>
                <span class="badge text-white" style="background: linear-gradient(90deg,#ff512f,#dd2476); font-size:1rem;">@Model.Products.Count sản phẩm</span>
            </div>
<a href="@Url.Action("Index", "Product")" class="btn btn-sm rounded-pill px-3" style="background: linear-gradient(90deg,#1976d2,#ffca28); color: #fff; border: none; font-weight:600; font-size:1.1rem; min-width:110px; border-radius:22px; transition:0.2s;">Xem tất cả</a>
        </div>
        <div class="row row-cols-1 row-cols-sm-2 row-cols-md-4 row-cols-lg-4 g-4">
            @foreach (var product in Model.Products.Take(8))
            {
                var flash = product.FlashSale;
                var now = DateTime.Now;
                bool isFlash = flash != null && flash.StartTime <= now && flash.EndTime >= now;
                var flashPrice = isFlash ? product.Price * (1 - flash.Discount) : 0;
                var finalPrice = isFlash ? flashPrice : (product.DiscountPrice > 0 ? product.DiscountPrice : product.Price);

                <div class="col d-flex align-items-stretch">
                    <div class="card h-100 border-0 shadow product-card position-relative" style="border-radius: 18px; overflow: hidden; background: #fff; transition: box-shadow 0.2s; min-width: 240px; max-width: 270px; margin: 0 auto;">
                        <img src="@product.ImagePath" class="card-img-top" alt="@product.Name"
                             style="height: 200px; object-fit: cover; background: #fbc2eb; border-radius: 16px 16px 0 0;">
                        @if (isFlash)
                        {
                            <div class="position-absolute top-0 end-0 m-2">
                                <span class="badge text-white px-3 py-1 animate__animated animate__flash animate__infinite" style="font-size:1rem; border-radius:10px; background: linear-gradient(90deg,#ff512f,#dd2476); box-shadow:0 0 8px #ff512f;">Flash Sale</span>
                            </div>
                        }
                        else if (product.DiscountPrice > 0)
                        {
                            <div class="position-absolute top-0 end-0 m-2">
                                <span class="badge text-white px-3 py-1" style="font-size:1rem; border-radius:10px; background: linear-gradient(90deg,#ffca28,#1976d2);">Sale</span>
                            </div>
                        }
                        <div class="card-body d-flex flex-column" style="padding-bottom:0.5rem;">
                            <h6 class="card-title fw-bold text-truncate text-center mt-1 mb-2" style="font-size:1.1rem; color:#ff512f;">@product.Name</h6>
                            @if (product.DiscountPrice > 0)
                            {
                                <div class="mb-2 d-flex flex-row align-items-center justify-content-center">
                                    <span class="text-decoration-line-through price-original" style="font-size:1rem; color:#bdbdbd;">@product.Price.ToString("N0") ₫</span>
                                    <span class="fw-bold ms-2" style="font-size:1.2rem; color:#ffca28;">@product.DiscountPrice?.ToString("N0") ₫</span>
                                </div>
                            }
                            else if (isFlash)
                            {
                                <div class="mb-2 d-flex flex-column align-items-center">
                                    <span class="text-muted text-decoration-line-through" style="font-size:1rem;">@product.Price.ToString("N0") ₫</span>
                                    <span class="fw-bold ms-2" style="font-size:1.2rem; color:#ffca28;">@flashPrice.ToString("N0") ₫</span>
                                </div>
                            }
                            else
                            {
                                <div class="mb-2 d-flex flex-column align-items-center">
                                    <span class="fw-bold ms-2" style="font-size:1.2rem; color:#ff512f;">@product.Price.ToString("N0") ₫</span>
                                </div>
                            }
                            <div class="mt-auto pt-0 w-100 d-flex justify-content-center">
                                <a href="@Url.Action("Details", "Product", new { id = product.Id })"
                                   class="btn btn-sm rounded-pill px-3 w-100" style="background: linear-gradient(90deg,#fbc2eb,#a18cd1); color: #fff; border: none; font-weight:600;">Xem chi tiết</a>
                            </div>
                        </div>
                    </div>
                </div>
            }
        </div>
    </div>
</section>



<!-- Sale Products -->
<section class="py-5" style="background: transparent;">
    <div class="container">
        <div class="d-flex align-items-center mb-4">
            <h2 class="mb-0 me-3 fw-bold" style="color:#dd2476; letter-spacing:1px;">Sale</h2>
            <div class="flex-grow-1">
                <hr class="border-2" style="border-color:#dd2476;">
            </div>
        </div>
        <div class="row row-cols-1 row-cols-sm-2 row-cols-md-4 g-4">
            @foreach (var product in Model.Products.Where(p => p.DiscountPrice != null && p.DiscountPrice > 0))
            {
                <div class="col d-flex align-items-stretch">
                    <div class="card h-100 border-0 shadow product-card position-relative" style="border-radius: 18px; overflow: hidden; background: #fff; transition: box-shadow 0.2s; min-width: 240px; max-width: 270px; margin: 0 auto;">
                        <img src="@product.ImagePath" class="card-img-top" alt="@product.Name"
                             style="height: 200px; object-fit: cover; background: #fbc2eb; border-radius: 16px 16px 0 0;">
                        <div class="card-body d-flex flex-column" style="padding-bottom:0.5rem;">
                            <h6 class="card-title fw-bold text-truncate" style="font-size:1.1rem; color:#dd2476;">@product.Name</h6>
                            @if (product.DiscountPrice != null && product.DiscountPrice > 0)
                            {
                                <div class="mb-2">
                                    <span class="text-muted text-decoration-line-through">@product.Price.ToString("N0") ₫</span>
                                    <span class="fw-bold ms-2" style="font-size:1.2rem; color:#ff512f;">@product.DiscountPrice?.ToString("N0") ₫</span>
                                </div>
                            }
                            else
                            {
                                <div class="mb-2">
                                    <span class="fw-bold ms-2" style="font-size:1.2rem; color:#ff512f;">@product.Price.ToString("N0") ₫</span>
                                </div>
                            }
                            <div class="mt-auto">
<a href="@Url.Action("Details", "Product", new { id = product.Id })"
   class="btn btn-sm rounded-pill px-3" style="background: linear-gradient(90deg,#fbc2eb,#a18cd1); color: #fff; border: none; font-weight:600;">Xem chi tiết</a>
                            </div>
                        </div>
                        <div class="position-absolute top-0 start-0 m-2">
<span class="badge text-white px-3 py-1" style="font-size:1rem; border-radius:10px; background: linear-gradient(90deg,#ffca28,#1976d2);">Sale</span>
                        </div>
                    </div>
                </div>
            }
        </div>
    </div>
</section>

<!-- Pre-order Section (same style as Sale/All Products, below Sale) -->
<section id="preorder-section" class="py-5" style="background: #fff;">
    <div class="container">
        <div class="d-flex align-items-center mb-4">
            <h2 class="mb-0 me-3 fw-bold" style="color:#a18cd1; letter-spacing:1px;">Pre-order</h2>
            <span class="badge text-white" style="background: linear-gradient(90deg,#a18cd1,#fbc2eb); font-size:1rem;">Đặt trước sản phẩm mới</span>
        </div>
        <div class="row row-cols-1 row-cols-sm-2 row-cols-md-4 g-4">
            @foreach (var product in Model.Products.Where(p => p.IsPreOrder))
            {
                <div class="col d-flex align-items-stretch">
                    <div class="card h-100 border-0 shadow product-card position-relative" style="border-radius: 18px; overflow: hidden; background: #fff; transition: box-shadow 0.2s;">
                        <img src="@product.ImagePath" class="card-img-top" alt="@product.Name"
                             style="height: 200px; object-fit: cover; background: #fbc2eb; border-radius: 16px 16px 0 0;">
                        <div class="card-body d-flex flex-column" style="padding-bottom:0.5rem;">
                            <h6 class="card-title fw-bold text-truncate" style="font-size:1.1rem; color:#a18cd1;">@product.Name</h6>
                            <div class="mb-2">
                                <span class="fw-bold ms-2" style="font-size:1.2rem; color:#a18cd1;">@product.Price.ToString("N0") ₫</span>
                            </div>
                            <div class="mt-auto">
                                <a href="@Url.Action("Details", "Product", new { id = product.Id })"
                                   class="btn btn-sm rounded-pill px-3" style="background: linear-gradient(90deg,#a18cd1,#fbc2eb); color: #fff; border: none; font-weight:600;">Xem chi tiết</a>
                            </div>
                        </div>
                        <div class="position-absolute top-0 start-0 m-2">
                            <span class="badge text-white px-3 py-1" style="font-size:1rem; border-radius:10px; background: linear-gradient(90deg,#a18cd1,#fbc2eb);">Pre-order</span>
                        </div>
                    </div>
                </div>
            }
        </div>
    </div>
</section>

<!-- News Section (dưới Pre-order, layout card trắng, lưới 4 cột)-->
<section id="news-section" class="py-5" style="background: #fff;">
    <div class="container">
        <div class="d-flex align-items-center mb-4">
            <h2 class="mb-0 me-3 fw-bold" style="color:#ff512f; letter-spacing:1px;">Tin tức mới</h2>
            <span class="badge text-white" style="background: linear-gradient(90deg,#ff512f,#dd2476); font-size:1rem;">News</span>
        </div>
        <div class="row row-cols-1 row-cols-sm-2 row-cols-md-4 g-4">
            <!-- News 1 -->
            <div class="col d-flex align-items-stretch">
                <div style="border: 1px solid #ececec; border-radius: 12px; background: #f9f9f9; padding: 0; width: 100%; display: flex; flex-direction: column;">
                    <img src="/images/News 1.jpg" alt="News 1" style="height: 160px; object-fit: cover; border-radius: 12px 12px 0 0;">
                    <div style="padding: 1rem; flex: 1; display: flex; flex-direction: column;">
                        <div style="font-size:1.2rem; font-weight:700; color:#ff512f; margin-bottom:0.5rem;">Khám phá vũ trụ Uma Musume</div>
                        <div style="font-size:0.98rem; color:#555; margin-bottom:0.5rem;">Với những trải nghiệm mới đầy màu sắc của Uma Musume Pretty Derby, việc làm quen với dàn "nàng ngựa" đông đảo...</div>
                        <div style="font-size:0.95rem; color:#888; margin-bottom:0.5rem;">26/07/2025</div>
                        <div style="margin-top:auto;">
                            <a href="#" style="font-size:0.95rem; background: #ff512f; color: #fff; border-radius: 8px; padding: 4px 16px; text-decoration:none;">Xem chi tiết</a>
                        </div>
                    </div>
                </div>
            </div>
            <!-- News 2 -->
            <div class="col d-flex align-items-stretch">
                <div style="border: 1px solid #ececec; border-radius: 12px; background: #f9f9f9; padding: 0; width: 100%; display: flex; flex-direction: column;">
                    <img src="/images/News 2.jpg" alt="News 2" style="height: 160px; object-fit: cover; border-radius: 12px 12px 0 0;">
                    <div style="padding: 1rem; flex: 1; display: flex; flex-direction: column;">
                        <div style="font-size:1.2rem; font-weight:700; color:#ff512f; margin-bottom:0.5rem;">Bộ sưu tập đồng hồ "Uma Musume"</div>
                        <div style="font-size:0.98rem; color:#555; margin-bottom:0.5rem;">BST đồng hồ phiên bản giới hạn Uma Musume đã chính thức ra mắt, mang đến trải nghiệm thời trang độc đáo cho fan!</div>
                        <div style="font-size:0.95rem; color:#888; margin-bottom:0.5rem;">25/07/2025</div>
                        <div style="margin-top:auto;">
                            <a href="#" style="font-size:0.95rem; background: #ff512f; color: #fff; border-radius: 8px; padding: 4px 16px; text-decoration:none;">Xem chi tiết</a>
                        </div>
                    </div>
                </div>
            </div>
            <!-- News 3 -->
            <div class="col d-flex align-items-stretch">
                <div style="border: 1px solid #ececec; border-radius: 12px; background: #f9f9f9; padding: 0; width: 100%; display: flex; flex-direction: column;">
                    <img src="/images/News 3.jpg" alt="News 3" style="height: 160px; object-fit: cover; border-radius: 12px 12px 0 0;">
                    <div style="padding: 1rem; flex: 1; display: flex; flex-direction: column;">
                        <div style="font-size:1.2rem; font-weight:700; color:#ff512f; margin-bottom:0.5rem;">Figure Mahiru Shiina Tea Party ver.</div>
                        <div style="font-size:0.98rem; color:#555; margin-bottom:0.5rem;">Phiên bản figure Mahiru Shiina Tea Party vừa ra mắt, thiết kế tinh xảo, màu sắc tươi sáng, phù hợp mọi bộ sưu tập.</div>
                        <div style="font-size:0.95rem; color:#888; margin-bottom:0.5rem;">25/07/2025</div>
                        <div style="margin-top:auto;">
                            <a href="#" style="font-size:0.95rem; background: #ff512f; color: #fff; border-radius: 8px; padding: 4px 16px; text-decoration:none;">Xem chi tiết</a>
                        </div>
                    </div>
                </div>
            </div>
            <!-- News 4 -->
            <div class="col d-flex align-items-stretch">
                <div style="border: 1px solid #ececec; border-radius: 12px; background: #f9f9f9; padding: 0; width: 100%; display: flex; flex-direction: column;">
                    <img src="/images/News 4.jpg" alt="News 4" style="height: 160px; object-fit: cover; border-radius: 12px 12px 0 0;">
                    <div style="padding: 1rem; flex: 1; display: flex; flex-direction: column;">
                        <div style="font-size:1.2rem; font-weight:700; color:#ff512f; margin-bottom:0.5rem;">METAL BUILD EX PROJECT HATSUNE MIKU</div>
                        <div style="font-size:0.98rem; color:#555; margin-bottom:0.5rem;">Dòng figure METAL BUILD EX PROJECT HATSUNE MIKU đã có mặt tại shop, dành cho fan Miku và các nhà sưu tập!</div>
                        <div style="font-size:0.95rem; color:#888; margin-bottom:0.5rem;">20/07/2025</div>
                        <div style="margin-top:auto;">
                            <a href="#" style="font-size:0.95rem; background: #ff512f; color: #fff; border-radius: 8px; padding: 4px 16px; text-decoration:none;">Xem chi tiết</a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

<script>
    document.querySelectorAll('.add-to-cart-btn').forEach(btn => {
        btn.addEventListener('click', function () {
            const productId = this.getAttribute('data-product-id');
            window.location.href = '/ShoppingCart/AddToCart?productId=' + productId;
        });
    });
</script>

<style>
.image-slider {
    position: relative;
    max-width: 800px;
    margin: 0 auto;
    overflow: hidden;
    border-radius: 10px;
    box-shadow: 0 4px 8px rgba(0,0,0,0.1);
}
.slider-container { position: relative; }
.slider-wrapper { display: flex; transition: transform 0.5s ease-in-out; width: calc(100% * 4); }
.slide { min-width: 25%; height: 300px; }
.slide img { width: 100%; height: 100%; object-fit: cover; border-radius:10px; box-shadow:0 4px 12px rgba(0,0,0,0.12); }
.slider-btn {
    position: absolute;
    top: 50%;
    transform: translateY(-50%);
    background: rgba(0,0,0,0.5);
    color: white;
    border: none;
    padding: 10px 15px;
    cursor: pointer;
    border-radius: 50%;
    font-size: 18px;
    transition: background 0.3s;
}
.slider-btn:hover { background: rgba(0,0,0,0.8); }
.prev-btn { left: 10px; }
.next-btn { right: 10px; }
.slider-dots {
    position: absolute;
    bottom: 20px;
    left: 50%;
    transform: translateX(-50%);
    display: flex;
    gap: 10px;
}
.dot {
    width: 12px;
    height: 12px;
    border-radius: 50%;
    background: rgba(255,255,255,0.5);
    cursor: pointer;
    transition: background 0.3s;
}
.dot.active { background: white; }
.product-card .card-title { min-height: 2.5em; }
/* Đảm bảo tên sản phẩm luôn chiếm đủ chiều cao cho 2 dòng */
.product-card .card-title { min-height: 2.6em; display: block; }
/* Đảm bảo phần giá luôn cùng vị trí giữa các card */
.product-card .price-block { min-height: 2.2em; display: flex; align-items: center; justify-content: center; }
/* Đảm bảo giá gốc hiển thị tốt ở cả light/dark mode */
.price-original { color: #bdbdbd !important; }
.dark-mode .price-original { color: #e0e0e0 !important; }
</style>

@section Scripts {
    <script src="~/js/site.js" asp-append-version="true"></script>
    <script> sliderInit(); </script>
    <script>
    document.querySelectorAll('.flash-sale-timer').forEach(timer => {
        const end = new Date(timer.getAttribute('data-end'));

        function update() {
            const now = new Date();
            const diff = end - now;
            if (diff <= 0) {
                timer.innerText = 'Đã kết thúc';
                return;
            }
            const h = Math.floor(diff / 1000 / 60 / 60);
            const m = Math.floor((diff / 1000 / 60) % 60);
            const s = Math.floor((diff / 1000) % 60);
            timer.innerText = `Còn lại: ${h}h ${m}m ${s}s`;
        }

        update();
        setInterval(update, 1000);
    });
</script>

}
